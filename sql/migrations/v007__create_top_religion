-- bahai_percent, buddhist_percent, chinese_folk_percent, christians_percent, confucianist_percent, daoist_percent, ethnic_religionist_percent, hindus_percent, jews_percent, non_religious_percent, muslims_percent, sikhs_percent
-- bahai, buddhist, chinese_folk, christians, confucianist, daoist, ethnic_religionist, hindus, jews, non_religious, muslims, sikhs


CREATE TABLE cleansed.nation_top_religions (
    nation VARCHAR(255),
    iso2 CHAR(2),
    first_popular_religion VARCHAR(255),
    first_percent DECIMAL(5,2),
    second_popular_religion VARCHAR(255),
    second_percent DECIMAL(5,2),
    third_popular_religion VARCHAR(255),
    third_percent DECIMAL(5,2)
);


-- UPDATE staging.all_countries_religion
-- SET
--     bahai = REGEXP_REPLACE(bahai::TEXT, '\D', '', 'g'),
--     buddhists = REGEXP_REPLACE(buddhists::TEXT, '\D', '', 'g'),
--     chinese_folk = REGEXP_REPLACE(chinese_folk::TEXT, '\D', '', 'g'),
--     christians = REGEXP_REPLACE(christians::TEXT, '\D', '', 'g'),
--     confucianist = REGEXP_REPLACE(confucianist::TEXT, '\D', '', 'g'),
--     daoist = REGEXP_REPLACE(daoist::TEXT, '\D', '', 'g'),
--     ethnic_religionist = REGEXP_REPLACE(ethnic_religionist::TEXT, '\D', '', 'g'),
--     hindus = REGEXP_REPLACE(hindus::TEXT, '\D', '', 'g'),
--     jews = REGEXP_REPLACE(jews::TEXT, '\D', '', 'g'),
--     non_religious = REGEXP_REPLACE(non_religious::TEXT, '\D', '', 'g'),
--     muslims = REGEXP_REPLACE(muslims::TEXT, '\D', '', 'g'),
--     sikhs = REGEXP_REPLACE(sikhs::TEXT, '\D', '', 'g')
-- WHERE bahai IS NOT NULL
-- OR buddhists IS NOT NULL
-- OR chinese_folk IS NOT NULL
-- OR christians IS NOT NULL
-- OR confucianist IS NOT NULL
-- OR daoist IS NOT NULL
-- OR ethnic_religionist IS NOT NULL
-- OR hindus IS NOT NULL
-- OR jews IS NOT NULL
-- OR non_religious IS NOT NULL
-- OR muslims IS NOT NULL
-- OR sikhs IS NOT NULL;

-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN bahai TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER COLUMN buddhists TYPE NUMERIC USING buddhists::NUMERIC;
-- ALTER COLUMN chinese_folk TYPE NUMERIC USING chinese_folk::NUMERIC;
-- ALTER COLUMN christians TYPE NUMERIC USING christians::NUMERIC;
-- ALTER COLUMN confucianist TYPE NUMERIC USING confucianist::NUMERIC;
-- ALTER COLUMN daoist TYPE NUMERIC USING daoist::NUMERIC;
-- ALTER COLUMN ethnic_religionist TYPE NUMERIC USING ethnic_religionist::NUMERIC;
-- ALTER COLUMN hindus TYPE NUMERIC USING hindus::NUMERIC;
-- ALTER COLUMN jews TYPE NUMERIC USING jews::NUMERIC;
-- ALTER COLUMN non_religious TYPE NUMERIC USING non_religious::NUMERIC;
-- ALTER COLUMN muslims TYPE NUMERIC USING muslims::NUMERIC;
-- ALTER COLUMN sikhs TYPE NUMERIC USING sikhs::NUMERIC;

-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN bahai TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN buddhists TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN chinese_folk TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN christians TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN confucianist TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN daoist TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN ethnic_religionist TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN hindus TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN jews TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN non_religious TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN muslims TYPE NUMERIC USING bahai::NUMERIC;
-- ALTER TABLE staging.all_countries_religion
-- ALTER COLUMN sikhs TYPE NUMERIC USING bahai::NUMERIC;